<section id="api" class="panel active" aria-label="API Reference">
  <div class="panel-card">
    <div class="panel-title">Overview</div>
    <p>This device exposes a simple REST-style HTTP+JSON API and a WebSocket stream for live telemetry. All endpoints are unauthenticated on the local / AP network. Base URL is the device IP (or mDNS name if enabled): <code>http://&lt;device-ip&gt;/</code>.</p>
    <p>Typical base (examples): <code>http://192.168.4.1/</code> (AP mode) or <code>http://momo.local/</code> (mDNS). Responses use <code>application/json</code> unless noted.</p>
  </div>

  <div class="panel-card">
    <div class="panel-title">Live Data (WebSocket)</div>
    <p>Connect to <code>ws://&lt;base&gt;/ws</code>. You will receive JSON objects with current readings and system stats once per second or when values change.</p>
    <pre class="code sm" style="white-space:pre;overflow:auto">Example (truncated):
{
  "temperature": 26.5,
  "humidity": 64.2,
  "dewPoint": 19.2,
  "heatIndex": 27.1,
  "vpd": 0.82,
  "absoluteHumidity": 15.3,
  "units": "C",
  "tempStatus": "Perfect",
  "humStatus": "Caution",
  "thresholds": { ... },
  "stats": { ... },
  "system": {
    "uptime": 1234567,
    "freeHeap": 215000,
    "sensorHz": 19.9,
    "displayHz": 9.9,
    "camera": true,
    "rssi": -48,
    "ip": "192.168.1.42",
    "hostname": "momo"
  },
  "ssid": "MyWiFi"
}</pre>
  </div>

  <div class="panel-card">
    <div class="panel-title">Endpoints</div>
    <p>Use the table below. Methods shown in caps. Query parameters optional unless marked required.</p>
    <div class="table-scroll">
      <table class="table sm">
        <thead><tr><th>Method</th><th>Path</th><th>Description</th><th>Notes / Body</th></tr></thead>
        <tbody>
          <tr><td>GET</td><td><code>/api/data</code></td><td>Latest environment + system snapshot</td><td>Same schema as websocket sample</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/status</code></td><td>Compact WiFi state</td><td>Connection + AP flags</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/info</code></td><td>Detailed WiFi + radio info</td><td>STA/AP, RSSI, channel, tx power</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/scan/start</code></td><td>Begin async scan</td><td>Returns 202 when started</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/scan/results</code></td><td>Retrieve scan results</td><td>Call until status != scanning</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/connect</code></td><td>Connect to network</td><td>JSON: { "ssid":"..", "password":".." }</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/reconnect</code></td><td>Retry last connection</td><td>No body</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/disconnect</code></td><td>Disconnect STA</td><td>No body</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/toggle_ap</code></td><td>Enable/disable AP</td><td>JSON: { "enable":true, "channel":6, "password":"opt" }</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/txpower/get</code></td><td>Current TX power (dBm)</td><td></td></tr>
          <tr><td>POST</td><td><code>/api/wifi/txpower/set</code></td><td>Set TX power</td><td>JSON: { "value": 20 }</td></tr>
          <tr><td>GET</td><td><code>/api/wifi/sleep/get</code></td><td>Get WiFi sleep state</td><td></td></tr>
          <tr><td>POST</td><td><code>/api/wifi/sleep/set</code></td><td>Enable/disable WiFi sleep</td><td>JSON: { "enable": false }</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/hostname/set</code></td><td>Set hostname + restart mDNS</td><td>JSON: { "hostname":"momo" }</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/mdns/restart</code></td><td>Restart mDNS service</td><td>No body</td></tr>
          <tr><td>POST</td><td><code>/api/wifi/forget</code></td><td>Erase saved STA creds & restart</td><td>No body</td></tr>
          <tr><td>GET</td><td><code>/api/settings/get</code></td><td>Fetch persisted settings</td><td>Hostname, units, thresholds, camera</td></tr>
          <tr><td>POST</td><td><code>/api/settings/save</code></td><td>Update settings</td><td>JSON: { hostname, units, thresholds:{...}, camera:{...} }</td></tr>
          <tr><td>POST</td><td><code>/api/system/reboot</code></td><td>Reboot device</td><td>No body</td></tr>
          <tr><td>GET</td><td><code>/api/camera/status</code></td><td>Camera availability</td><td>{ available: bool }</td></tr>
          <tr><td>GET</td><td><code>/api/camera/snapshot</code></td><td>Current frame (JPEG)</td><td>Content-Type: image/jpeg</td></tr>
          <tr><td>GET</td><td><code>/api/camera/stream</code></td><td>MJPEG streaming</td><td>multipart/x-mixed-replace</td></tr>
          <tr><td>POST</td><td><code>/api/camera/restart</code></td><td>Re-init camera</td><td>No body</td></tr>
          <tr><td>GET</td><td><code>/api/camera/stream_stats</code></td><td>Streaming counters</td><td>frames, bytes, since</td></tr>
          <tr><td>POST</td><td><code>/api/camera/ctrl</code></td><td>Adjust camera params</td><td>JSON keys: wb_mode, brightness, contrast, saturation, ae_level, aec2, gainceiling, lenc, bpc, wpc, dcw, hmirror, vflip, special, colorbar</td></tr>
          <tr><td>GET</td><td><code>/api/camera/snapshot_full</code></td><td>Attempt high-res capture</td><td>Query: ?q=12&size=10 (optional)</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="panel-card">
    <div class="panel-title">Example: Fetch Latest Data</div>
    <pre class="code sm" style="white-space:pre;overflow:auto">curl http://momo.local/api/data
# or
fetch('http://momo.local/api/data')
  .then(r=>r.json())
  .then(console.log)</pre>
  </div>

  <div class="panel-card">
    <div class="panel-title">Example: Connect WiFi</div>
    <pre class="code sm" style="white-space:pre;overflow:auto">curl -X POST http://momo.local/api/wifi/connect \
  -H "Content-Type: application/json" \
  -d '{"ssid":"MySSID","password":"secret"}'</pre>
  </div>

  <div class="panel-card">
    <div class="panel-title">Notes</div>
    <ul class="muted" style="font-size:.9rem;line-height:1.4">
      <li>All operations are unauthenticated; secure the network for production.</li>
      <li>Camera endpoints return 503 if the camera failed to initialize.</li>
      <li>/api/camera/snapshot_full temporarily adjusts sensor size/quality then restores previous settings.</li>
      <li>WebSocket events: <code>wifi_connected</code>, <code>wifi_failed</code> may appear for portal transitions.</li>
      <li>Field units: temperature °C (or °F if configured), humidity %, VPD kPa, absoluteHumidity g/m³.</li>
    </ul>
  </div>
</section>
